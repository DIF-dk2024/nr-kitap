<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='logo.jpeg') }}">
  <title>Edit {{ sid }}</title>
  <style>
    :root{--bg:#000;--card:#0b0b0b;--card2:#111;--text:#fff;--muted:#bdbdbd;--border:#222;--accent:#FF9F0A;}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    .wrap{max-width:980px;margin:0 auto;padding:22px 14px 60px;}
    a{color:var(--accent);text-decoration:none}
    .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:10px;flex-wrap:wrap;}
    .btn{border:1px solid var(--border);background:#111;color:#fff;border-radius:14px;padding:10px 12px;font-weight:800;cursor:pointer;}
    .btn.accent{background:var(--accent);color:#000;border-color:transparent;}
    .danger{border-color:#402;background:#120;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:14px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:720px){.grid{grid-template-columns:1fr}}
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px;}
    input,textarea,select{width:100%;padding:12px;border-radius:14px;border:1px solid var(--border);background:var(--card2);color:var(--text);outline:none;font-size:14px;}
    textarea{min-height:110px;resize:vertical}
    .row{margin-top:12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .flash{background:#140d00;border:1px solid rgba(255,159,10,.35);color:#ffd9a1;padding:10px 12px;border-radius:14px;margin:10px 0 0;font-size:13px;}
    .photos{margin-top:14px;}
    .pgrid{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:10px;}
    @media(max-width:720px){.pgrid{grid-template-columns:repeat(3,minmax(0,1fr));}}
    .thumb{border:1px solid var(--border);border-radius:14px;overflow:hidden;background:#0e0e0e;aspect-ratio:1/1;position:relative;}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block;}
    .thumb form{position:absolute;left:8px;right:8px;bottom:8px;}
    .thumb button{width:100%;border:1px solid #402;background:#120;color:#fff;border-radius:10px;padding:6px 8px;font-weight:800;cursor:pointer;font-size:12px;}
    code{background:#111;border:1px solid #222;padding:2px 6px;border-radius:8px;color:#fff}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <a href="/admin">← назад</a>
        <div style="height:6px"></div>
        <div style="color:var(--muted);font-size:12px;">ID: <code>{{ sid }}</code></div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <a class="btn" href="/uploads/{{ sid }}/{{ first_photo }}" target="_blank" rel="noreferrer" {% if not first_photo %}style="display:none"{% endif %}>Открыть файл</a>
        <form method="post" action="/admin/delete/{{ sid }}" onsubmit="return confirm('Удалить {{ sid }} и все файлы?')">
          <button class="btn danger" type="submit">Удалить</button>
        </form>
      </div>
    </div>

    {% with messages = get_flashed_messages() %}
      {% if messages %}<div class="flash">{{ messages[0] }}</div>{% endif %}
    {% endwith %}

    <div class="card">
      <form method="post" action="/admin/save/{{ sid }}">
        <div class="grid">
          <div>
            <label>Стоимость (необязательно)</label>
            <input name="price_tenge" value="{{ row.price_tenge }}">
          </div>
          <div>
            <label>Пароль (необязательно)</label>
            <input name="password" value="{{ row.password }}" placeholder="если заполнить — файлы будут защищены">
          </div>
          <div style="grid-column:1/-1">
            <label>Название</label>
            <input name="title" value="{{ row.title }}">
          </div>
          <div style="grid-column:1/-1">
            <label>Описание</label>
            <textarea name="description">{{ row.description }}</textarea>
          </div>
        </div>
        <div class="row">
          <button class="btn accent" type="submit">Сохранить</button>
          <a class="btn" href="/admin">К списку</a>
        </div>
      </form>
    </div>

    <div class="photos">
      <h3 style="margin:16px 0 10px;">Файлы</h3>

      <div class="card">
        <form method="post" action="/admin/upload/{{ sid }}" enctype="multipart/form-data">
          <label>Добавить файлы</label>
          <input name="photos" type="file" multiple>
          <div class="row">
            <button class="btn accent" type="submit">Загрузить</button>
          </div>
        </form>
      </div>

      <div style="height:10px"></div>

      {% if photos and photos|length %}
        <div class="pgrid">
          {% for p in photos %}
            <div class="thumb">
              <a href="/uploads/{{ sid }}/{{ p }}" target="_blank" rel="noreferrer">
                <img src="/uploads/{{ sid }}/{{ p }}" alt="{{ p }}">
              </a>
              <form method="post" action="/admin/photo_delete/{{ sid }}/{{ p }}" onsubmit="return confirm('Удалить файл {{ p }}?')">
                <button type="submit">Удалить</button>
              </form>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div style="color:var(--muted);font-size:12px;">Файлов нет.</div>
      {% endif %}
    </div>
  </div>
</body>
</html>
